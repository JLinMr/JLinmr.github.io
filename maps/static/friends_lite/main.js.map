{"version":3,"file":"../../../static/friends_lite/main.js","names":["window","FriendCircleLite","constructor","rootId","this","root","document","getElementById","config","UserConfig","pageSize","page_turning_number","apiUrl","private_api_url","errorImg","error_img","start","allArticles","cacheKey","cacheTimeKey","cacheDuration","cache_duration","throttledLoadMore","throttle","loadMore","bind","imageObserver","IntersectionObserver","handleImageIntersection","fishingTimes","parseInt","localStorage","getItem","fishingClicks","isWorking","fishConfig","defaultFish","hungryFish","fishing_config","init","fcInstance","elements","container","querySelector","stats","random","handleClick","addEventListener","updateRandomArticle","loadInitialContent","loadArticles","data","fetchArticlesWithCache","article_data","updateStats","statistical_data","displayArticles","error","console","textContent","cached","getCache","fromCache","response","fetch","json","setCache","Error","cacheTime","Date","now","JSON","parse","setItem","stringify","toString","e","warn","isInitial","end","articles","slice","length","style","display","innerHTML","fragment","createDocumentFragment","forEach","article","appendChild","createCard","cards","querySelectorAll","index","animate","card","classList","remove","add","requestAnimationFrame","setTimeout","animateCards","isLoading","createElement","className","link","title","author","avatar","created","substring","target","closest","dataset","open","authorData","showAuthorModal","id","contains","friends_num","active_num","article_num","last_updated_time","level","getFishingLevel","levelInfo","Math","delay","floor","Promise","resolve","randomArticle","tips","randomTip","times","modal","authorArticles","filter","a","map","join","URL","origin","onclick","parentNode","removeChild","once","body","func","limit","inThrottle","args","apply","entries","observer","entry","isIntersecting","img","src","unobserve","cleanup","removeEventListener","disconnect","initializeFriendCircleLite","instance","readyState"],"sources":["static/friends_lite/main.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// 修改类声明，防止重复定义\nif (typeof window.FriendCircleLite === 'undefined') {\n    window.FriendCircleLite = class {\n        constructor(rootId) {\n            this.root = document.getElementById(rootId);\n            if (!this.root) return;\n            \n            const config = UserConfig ?? {};\n            this.pageSize = config.page_turning_number ?? 25;\n            this.apiUrl = config.private_api_url ?? 'https://fc.ruom.top';\n            this.errorImg = config.error_img ?? 'https://fastly.jsdelivr.net/gh/JLinMr/Friend-Circle-Lite@latest/static/favicon.ico';\n            this.start = 0;\n            this.allArticles = [];\n            this.cacheKey = 'fcl_cache';\n            this.cacheTimeKey = 'fcl_time';\n            this.cacheDuration = config.cache_duration ?? 10 * 60 * 1000; // 默认10分钟\n\n            this.throttledLoadMore = this.throttle(this.loadMore.bind(this), 500);\n            this.imageObserver = new IntersectionObserver(this.handleImageIntersection.bind(this));\n\n            this.fishingTimes = parseInt(localStorage.getItem('fcl_fishing_times') || '0');\n            this.fishingClicks = parseInt(localStorage.getItem('fcl_fishing_clicks') || '0');\n            this.isWorking = false;\n\n            this.fishConfig = {\n                defaultFish: 100,\n                hungryFish: 100,\n                ...UserConfig?.fishing_config\n            };\n\n            this.init();\n            window.fcInstance = this;\n        }\n\n        init() {\n            this.elements = {\n                container: this.root.querySelector('.articles-container'),\n                loadMore: this.root.querySelector('#load-more'),\n                stats: this.root.querySelector('#stats'),\n                random: this.root.querySelector('#random-article')\n            };\n\n            // 事件委托\n            this.handleClick = this.handleClick.bind(this);\n            this.root.addEventListener('click', this.handleClick);\n            window.updateRandomArticle = () => this.updateRandomArticle();\n            \n            this.loadInitialContent();\n        }\n\n        async loadInitialContent() {\n            // 移除添加骨架屏的逻辑，直接加载文章\n            await this.loadArticles();\n        }\n\n        async loadArticles() {\n            try {\n                const {data} = await this.fetchArticlesWithCache();\n                if (data?.article_data) {\n                    this.allArticles = data.article_data;\n                    this.updateStats(data.statistical_data);\n                    this.updateRandomArticle();\n                    await this.displayArticles(true);\n                }\n            } catch (error) {\n                console.error('加载文章失败:', error);\n                this.elements.loadMore.textContent = '加载失败';\n            }\n        }\n\n        async fetchArticlesWithCache() {\n            try {\n                const cached = this.getCache();\n                if (cached) return { data: cached, fromCache: true };\n\n                const response = await fetch(`${this.apiUrl}all.json`);\n                const data = await response.json();\n                \n                this.setCache(data);\n                return { data, fromCache: false };\n            } catch (error) {\n                throw new Error('获取文章列表失败');\n            }\n        }\n\n        getCache() {\n            try {\n                const cacheTime = localStorage.getItem(this.cacheTimeKey);\n                if (!cacheTime) return null;\n                \n                const now = Date.now();\n                if (now - parseInt(cacheTime) >= this.cacheDuration) return null;\n                \n                const cached = localStorage.getItem(this.cacheKey);\n                return cached ? JSON.parse(cached) : null;\n            } catch {\n                return null;\n            }\n        }\n\n        setCache(data) {\n            try {\n                localStorage.setItem(this.cacheKey, JSON.stringify(data));\n                localStorage.setItem(this.cacheTimeKey, Date.now().toString());\n            } catch (e) {\n                console.warn('缓存存储失败:', e);\n            }\n        }\n\n        async displayArticles(isInitial = false) {\n            const start = isInitial ? 0 : this.start;\n            const end = start + this.pageSize;\n            const articles = this.allArticles.slice(start, end);\n            \n            if (articles.length === 0) {\n                this.elements.loadMore.style.display = 'none';\n                return;\n            }\n\n            if (isInitial) {\n                this.elements.container.innerHTML = '';\n            }\n\n            const fragment = document.createDocumentFragment();\n            articles.forEach(article => {\n                fragment.appendChild(this.createCard(article));\n            });\n            \n            this.elements.container.appendChild(fragment);\n            \n            // 使用 requestAnimationFrame 优化动画显示\n            const animateCards = () => {\n                const cards = this.elements.container.querySelectorAll('.card.loading');\n                let index = 0;\n                \n                const animate = () => {\n                    if (index >= cards.length) return;\n                    \n                    const card = cards[index];\n                    card.classList.remove('loading');\n                    card.querySelector('.skeleton-content').classList.add('hidden');\n                    card.querySelector('.real-content').classList.remove('hidden');\n                    \n                    index++;\n                    requestAnimationFrame(animate);\n                };\n\n                setTimeout(() => {\n                    requestAnimationFrame(animate);\n                }, isInitial ? 1000 : 500);\n            };\n\n            animateCards();\n\n            this.start = end;\n            this.elements.loadMore.style.display = \n                this.start >= this.allArticles.length ? 'none' : 'block';\n        }\n\n        createCard(article, isLoading = true) {\n            const card = document.createElement('div');\n            card.className = `card ${isLoading ? 'loading' : ''}`;\n            \n            card.innerHTML = `\n                ${isLoading ? `\n                    <div class=\"skeleton-content\">\n                        <div class=\"skeleton card-title\"></div>\n                        <div class=\"card-info\">\n                            <div class=\"skeleton card-author\"></div>\n                            <div class=\"skeleton card-date\"></div>\n                        </div>\n                    </div>\n                ` : ''}\n                <div class=\"real-content ${isLoading ? 'hidden' : ''}\">\n                    <div class=\"card-title\" data-link=\"${article.link}\">${article.title}</div>\n                    <div class=\"card-info\">\n                        <div class=\"card-author\" data-author=\"${article.author}\" data-avatar=\"${article.avatar}\" data-link=\"${article.link}\">\n                            <img src=\"${article.avatar}\" data-error-img=\"${this.errorImg}\" onerror=\"if(!this.retried){this.retried=true;this.src=this.dataset.errorImg}\">\n                            ${article.author}\n                        </div>\n                        <div class=\"card-date\">🗓️${article.created?.substring(0, 10) || ''}</div>\n                    </div>\n                    <img class=\"card-bg\" src=\"${article.avatar}\" data-error-img=\"${this.errorImg}\" onerror=\"if(!this.retried){this.retried=true;this.src=this.dataset.errorImg}\">\n                </div>\n            `;\n            \n            return card;\n        }\n\n        handleClick(e) {\n            const target = e.target;\n            \n            if (target.closest('.card-title')) {\n                const link = target.closest('.card-title').dataset.link;\n                if (link) window.open(link, '_blank');\n            }\n            \n            if (target.closest('.card-author')) {\n                const authorData = target.closest('.card-author').dataset;\n                if (authorData.author && authorData.avatar && authorData.link) {\n                    this.showAuthorModal(authorData);\n                }\n            }\n            \n            if (target.id === 'load-more') {\n                this.loadMore();\n            }\n\n            if (target.classList.contains('random-refresh') || target.closest('.random-refresh')) {\n                this.updateRandomArticle();\n            }\n\n            if (target.classList.contains('random-title')) {\n                const link = target.dataset.link;\n                if (link) window.open(link, '_blank');\n            }\n            \n            if (target.classList.contains('random-author')) {\n                const authorData = {\n                    author: target.dataset.author,\n                    avatar: target.dataset.avatar,\n                    link: target.dataset.link\n                };\n                this.showAuthorModal(authorData);\n            }\n\n            if (target.classList.contains('random-title') || \n                target.classList.contains('card-title')) {\n                this.fishingClicks++;\n                localStorage.setItem('fcl_fishing_clicks', this.fishingClicks.toString());\n            }\n        }\n\n        updateStats(stats) {\n            if (!stats) return;\n            this.elements.stats.innerHTML = `\n                <div>Powered by: <a href=\"https://github.com/willow-god/Friend-Circle-Lite\" target=\"_blank\" rel=\"nofollow\">FriendCircleLite</a></div>\n                <div>Designed By: <a href=\"https://www.liushen.fun/\" target=\"_blank\" rel=\"nofollow\">LiuShen</a></div>\n                <div>订阅:${stats.friends_num} 活跃:${stats.active_num} 总文章数:${stats.article_num}</div>\n                <div>更新时间:${stats.last_updated_time}</div>\n            `;\n        }\n\n        async updateRandomArticle() {\n            if (this.isWorking) return;\n            this.isWorking = true;\n\n            // 获取当前等级信息\n            const level = this.getFishingLevel();\n            const levelInfo = this.fishingTimes >= 5 ? \n                `（Lv.${this.fishingTimes} 当前称号：${level}）` : \n                '';\n\n            // 检查是否饥饿\n            const isHungry = this.fishingClicks * this.fishConfig.hungryFish + this.fishConfig.defaultFish < this.fishingTimes \n                && Math.random() < 0.5;\n            \n            if (isHungry) {\n                this.elements.random.innerHTML = `\n                    <div class=\"random-content\">\n                        因为只钓鱼不吃鱼，过分饥饿导致本次钓鱼失败...${levelInfo}<br>\n                        (点击任意一篇钓鱼获得的文章即可恢复）\n                    </div>\n                `;\n                this.isWorking = false;\n                return;\n            }\n\n            // 显示钓鱼中状态\n            this.elements.random.innerHTML = `\n                <div class=\"random-content\">\n                    钓鱼中... ${levelInfo}\n                </div>\n            `;\n\n            // 随机延迟\n            const delay = this.fishingTimes === 0 ? 0 : Math.floor(Math.random() * 2000) + 1000;\n            await new Promise(resolve => setTimeout(resolve, delay));\n\n            const randomArticle = this.allArticles[Math.floor(Math.random() * this.allArticles.length)];\n            if (!randomArticle) {\n                this.isWorking = false;\n                return;\n            }\n\n            // 获取随机提示语\n            const tips = [\n                \"钓到了绝世好文！\",\n                \"在河边打了个喷嚏，吓跑了\",\n                \"你和小伙伴抢夺着\",\n                \"你击败了巨龙，在巢穴中发现了\",\n                \"挖掘秦始皇坟时找到了\",\n                \"在路边闲逛的时候随手买了一个\",\n                \"从学校班主任那拿来了孩子上课偷偷看的\",\n                \"你的同桌无情的从你的语文书中撕下了那篇你最喜欢的\",\n                \"考古学家近日发现了\",\n                \"外星人降临地球学习地球文化，落地时被你塞了\",\n                \"从图书馆顶层的隐秘角落里发现了闪着金光的\",\n                \"徒弟修炼走火入魔，为师立刻掏出了\",\n                \"在大山中唱山歌，隔壁的阿妹跑来了，带着\",\n                \"隔壁家的孩子数学考了满分，都是因为看了\",\n                \"隔壁家的孩子英语考了满分，都是因为看了\",\n                \"小米研发了全新一代MIX手机，据说灵感\",\n                \"修炼渡劫成功，还好提前看了\",\n                \"库克坐上了苹果CEO的宝座，因为他面试的时候看了\",\n                \"阿里巴巴大喊芝麻开门，映入眼帘的就是\",\n                \"师傅说练武要先炼心，然后让我好生研读\",\n                \"科考队在南极大陆发现了被冰封的\",\n                \"飞机窗户似乎被一张纸糊上了，仔细一看是\",\n                \"历史上满写的仁义道德四个字，透过字缝里却全是\",\n                \"十几年前的录音机似乎还能够使用，插上电发现正在播的是\",\n                \"新版语文书拟增加一篇熟读并背诵的\",\n                \"经调查，99%的受访者都没有背诵过\",\n                \"今年的高考满分作文是\",\n                \"唐僧揭开了佛祖压在五指山上的\",\n                \"科学家发现能够解决衰老的秘密，就是每日研读\",\n                \"英特尔发布了全新的至强处理器，其芯片的制造原理都是\",\n                \"新的iPhone产能很足，新的进货渠道是\",\n                \"今年亩产突破了八千万斤，多亏了\",\n                \"陆隐一统天上宗，在无数祖境高手的目光下宣读了\",\n                \"黑钻风跟白钻风说道，吃了唐僧肉能长生不老，他知道是因为看了\",\n                \"上卫生间没带纸，直接提裤跑路也不愿意玷污手中\",\n                \"种下一篇文章就会产生很多很多文章，我种下了\",\n                \"三十年河东，三十年河西，莫欺我没有看过\",\n                \"踏破铁血无觅处，得来全靠\",\n                \"今日双色球中了两千万，预测全靠\",\n                \"因为卷子上没写名字，老师罚抄\",\n                \"为了抗议世间的不公，割破手指写下了\",\n                \"在艺术大街上被贴满了相同的纸，走近一看是\",\n                \"这区区迷阵岂能难得住我？其实能走出来多亏了\",\n                \"今日被一篇文章顶上了微博热搜，它是\",\n                \"你送给乞丐一个暴富秘籍，它是\",\n                \"UZI一个走A拿下五杀，在事后采访时说他当时回想起了\",\n                \"科学家解刨了第一个感染丧尸病毒的人，发现丧尸抗体存在于\",\n                \"如果你有梦想的话，就要努力去看\",\n                \"决定我们成为什么样人的，不是我们的能力，而是是否看过\",\n                \"有信心不一定会成功，没信心就去看\",\n                \"你真正是谁并不重要，重要的是你看没看过\",\n                \"玄天境重要的是锻体，为师赠你此书，好好修炼去吧，这是\",\n                \"上百祖境高手在天威湖大战三天三夜为了抢夺\",\n                \"这化仙池水乃上古真仙对后人的考校，要求熟读并背诵\",\n                \"庆氏三千年根基差点竟被你小子毁于一旦，能够被我拯救全是因为我看了\",\n                \"我就是神奇宝贝大师！我这只皮卡丘可是\",\n                \"我就是神奇宝贝大师！我这只小火龙可是\",\n                \"我就是神奇宝贝大师！我这只可达鸭可是\",\n                \"我就是神奇宝贝大师！我这只杰尼龟可是\",\n                \"上古遗迹中写道，只要习得此书，便得成功。你定睛一看，原来是\",\n                \"奶奶的，玩阴的是吧，我就是双料特工代号穿山甲，\",\n                \"你的背景太假了，我的就逼真多了，学到这个技术全是因为看了\",\n                \"我是云南的，云南怒江的，怒江芦水市，芦水市六库，六库傈僳族，傈僳族是\",\n                \"我真的栓Q了，我真的会谢如果你看\",\n                \"你已经习得退退退神功，接下来的心法已经被记录在\",\n                \"人生无常大肠包小肠，小肠包住了\",\n                \"你抽到了普通文章，它是\",\n                \"你收到了稀有文章，它是\",\n                \"你抽到了金色普通文章，它是\",\n                \"你抽到了金色稀有文章，它是\",\n                \"你抽到了传说文章！它是\",\n                \"哇！金色传说！你抽到了金色传说文章，它是\",\n                \"报告！侦察兵说在前往300米有一个男子在偷偷看一本书，上面赫然写着\",\n                \"芷莲姑娘大摆擂台，谁若是能读完此书，便可娶了她。然后从背后掏出了\",\n                \"请问你的梦想是什么？我的梦想是能读到\",\n                \"读什么才能增智慧？当然是读\",\n                \"纳兰嫣然掏出了退婚书，可是发现出门带错了，结果拿出了一本\",\n                \"你要尽全力保护你的梦想。那些嘲笑你的人，他们必定会失败，他们想把你变成和他们一样的人。如果你有梦想的话，就要努力去读\",\n                \"走人生的路就像爬山一样，看起来走了许多冤枉的路，崎岖的路，但终究需要读完\",\n                \"游戏的规则就是这么的简单，你听懂了吗？管你听没听懂，快去看\",\n            ];\n            const randomTip = tips[Math.floor(Math.random() * tips.length)];\n\n            this.elements.random.innerHTML = `\n                <div class=\"random-content\">\n                    ${randomTip}\n                    <span class=\"random-author\" data-author=\"${randomArticle.author}\" \n                        data-avatar=\"${randomArticle.avatar}\" \n                        data-link=\"${randomArticle.link}\">${randomArticle.author}</span>\n                    的\n                    <span class=\"random-title\" data-link=\"${randomArticle.link}\">${randomArticle.title}</span>\n                </div>\n            `;\n\n            // 更新钓鱼次数\n            this.fishingTimes++;\n            localStorage.setItem('fcl_fishing_times', this.fishingTimes.toString());\n            \n            this.isWorking = false;\n        }\n\n        getFishingLevel() {\n            const times = this.fishingTimes;\n            if (times > 10000) return \"愿者上钩\";\n            if (times > 1000) return \"俯览天下\";\n            if (times > 100) return \"绝世渔夫\";\n            if (times > 75) return \"钓鱼王者\";\n            if (times > 50) return \"钓鱼宗师\";\n            if (times > 20) return \"钓鱼专家\";\n            if (times > 5) return \"钓鱼高手\";\n            return \"钓鱼新手\";\n        }\n\n        showAuthorModal({author, avatar, link}) {\n            // 检查是否已存在 modal\n            let modal = document.getElementById('modal');\n            if (!modal) {\n                modal = document.createElement('div');\n                modal.id = 'modal';\n                modal.className = 'modal';\n            }\n            \n            const authorArticles = this.allArticles\n                .filter(a => a.author === author)\n                .slice(0, 5)\n                .map(a => `\n                    <div class=\"modal-article\">\n                        <a class=\"modal-article-title\" href=\"${a.link}\" target=\"_blank\">${a.title}</a>\n                        <div class=\"modal-article-date\">📅${a.created.substring(0, 10)}</div>\n                    </div>\n                `).join('');\n\n            modal.innerHTML = `\n                <div class=\"modal-content\">\n                    <img class=\"modal-avatar\" src=\"${avatar}\" alt=\"${author}\" data-error-img=\"${this.errorImg}\" onerror=\"if(!this.retried){this.retried=true;this.src=this.dataset.errorImg}\">\n                    <a href=\"${new URL(link).origin}\" class=\"modal-link\" target=\"_blank\">${author}</a>\n                    <div class=\"modal-articles\">${authorArticles}</div>\n                    <img class=\"modal-background\" src=\"${avatar}\" alt=\"\" data-error-img=\"${this.errorImg}\" onerror=\"if(!this.retried){this.retried=true;this.src=this.dataset.errorImg}\">\n                </div>\n            `;\n\n            modal.onclick = e => {\n                if (e.target === modal) {\n                    modal.classList.remove('modal-open');\n                    modal.addEventListener('transitionend', () => {\n                        modal.style.display = 'none';\n                        if (modal.parentNode) {\n                            modal.parentNode.removeChild(modal);\n                        }\n                    }, { once: true });\n                }\n            };\n\n            document.body.appendChild(modal);\n            modal.style.display = 'block';\n            setTimeout(() => modal.classList.add('modal-open'), 10);\n        }\n\n        loadMore() {\n            this.displayArticles();\n        }\n\n        throttle(func, limit) {\n            let inThrottle;\n            return function(...args) {\n                if (!inThrottle) {\n                    func.apply(this, args);\n                    inThrottle = true;\n                    setTimeout(() => inThrottle = false, limit);\n                }\n            }\n        }\n\n        handleImageIntersection(entries, observer) {\n            entries.forEach(entry => {\n                if (entry.isIntersecting) {\n                    const img = entry.target;\n                    img.src = img.dataset.src;\n                    observer.unobserve(img);\n                }\n            });\n        }\n\n        cleanup() {\n            // 清理事件监听\n            this.root?.removeEventListener('click', this.handleClick);\n            // 清理 IntersectionObserver\n            this.imageObserver?.disconnect();\n            // 重置变量\n            this.start = 0;\n            this.allArticles = [];\n        }\n    }\n}\n\n// 将初始化函数也放到全局作用域\nif (typeof window.initializeFriendCircleLite === 'undefined') {\n    window.initializeFriendCircleLite = (() => {\n        let instance = null;\n        return () => {\n            if (instance) {\n                instance.cleanup();\n                window.fcInstance = null;\n            }\n            instance = new window.FriendCircleLite('friend-circle-lite-root');\n            return instance;\n        };\n    })();\n}\n\n// 修改初始化逻辑\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', window.initializeFriendCircleLite);\n} else {\n    window.initializeFriendCircleLite();\n}\n\n// PJAX 支持\ndocument.addEventListener('pjax:complete', window.initializeFriendCircleLite);"]}